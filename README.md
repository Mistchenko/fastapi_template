# fastapi_template
Fastapi template

Шаблон сервиса

## Папка `config`

По сути тут только конфигурационный скрипт для запуска gunicorn

В файле `gunicorn/conf.py` только минимально необходимые параметры для запуска

Для uvicorn отдельный файл не нужен (но если очень хочется то можно), достаточно использовать общий,
об общих файлах ниже.

## Папка `logger`

Тут вся конфигурация для вывода логов для обоих режимов (dev и prod), т.е. `общий`

### file: `logger/conf.base.yaml`

Конфигурация для логов, используется как параметр `--log-config` для запуска **uvicorn** 
и как файл загрузки словоря настроек `logconfig_dict` для запуска **gunicorn** 

### file: `logger/formatter.py`

Тут кастомный класс от `logging.Formatter` основная задача которого проверить существуют ли все нужные нам значения 
для вывода строки лога и расстановки "пустых" значений по умолчанию. 
Если этого не делать то при отсутствии какого нибудь значения (например при старте воркера) сервис будет падать с ошибкой.

### file: `logger/middleware.py`

Тут родной FastAPI middleware: `LoggerMiddleware` основная задача которого при получении http запроса зарегистрировать в логере необходимые данные.
В данной реализации, на каждый запрос формируется уникальный идентификатор запроса (rid) 
и это гарантированно работает для любого количества воркеров с учетом асинхронной работы

## Папка `script`

Скрипт для запуска сервиса в разных режимах (см. комментарии в скрипте)

## Папка `src`

Папка с исходниками, тут важно в запускающем файле `main.py` зарегистрировать `LoggerMiddleware` 
иначе все дополнительные параметры логирования будут `"-"`
